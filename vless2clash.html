<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠéº» VLESS è½¬ YAML (å®šåˆ¶ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; background-color: #f2f4f7; color: #333; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1 { text-align: center; margin-top: 0; color: #007aff; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; font-family: monospace; font-size: 14px; }
        input:focus { border-color: #007aff; outline: none; }
        
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        .btn-gen { background-color: #007aff; color: white; }
        .btn-copy { background-color: #34c759; color: white; }

        textarea { width: 100%; height: 450px; padding: 15px; margin-top: 20px; border: 1px solid #ddd; border-radius: 8px; font-family: "Menlo", "Consolas", monospace; font-size: 13px; background-color: #fafafa; white-space: pre; overflow-wrap: normal; overflow-x: auto; }
        .preview-icon { text-align: center; margin-bottom: 15px; }
        .preview-icon img { width: 40px; height: 40px; border-radius: 50%; vertical-align: middle; margin-right: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸš€ èŠéº» VLESS ä¸€é”®è½¬æ¢å™¨</h1>
    
    <div class="preview-icon">
        <span>å†…ç½®å›¾æ ‡ï¼š</span>
        <img src="https://www.helloimg.com/i/2026/01/30/697c132a23439.jpg" alt="Icon">
    </div>

    <label for="vlessLink">è¯·ç²˜è´´ä½ çš„ vless:// é“¾æ¥ï¼š</label>
    <input type="text" id="vlessLink" placeholder="vless://be3fa8be-53f3-4855-85de-9b30fadab228@...">

    <div class="btn-group">
        <button class="btn-gen" onclick="startConvert()">ğŸ› ï¸ ç”Ÿæˆé…ç½®æ–‡ä»¶</button>
        <button class="btn-copy" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </div>

    <textarea id="output" placeholder="ç‚¹å‡»ç”Ÿæˆåï¼Œç»“æœæ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
</div>

<script>
    // ä½ çš„çŒ«çŒ«å›¾
    const ICON_URL = "https://www.helloimg.com/i/2026/01/30/697c132a23439.jpg";

    function startConvert() {
        const input = document.getElementById('vlessLink').value.trim();
        
        if (!input) { alert("è¯·å…ˆç²˜è´´é“¾æ¥ï¼"); return; }
        if (!input.startsWith("vless://")) { alert("è¿™ä¸æ˜¯ vless:// å¼€å¤´çš„é“¾æ¥ï¼Œè¯·æ£€æŸ¥å¤åˆ¶æ˜¯å¦å®Œæ•´ã€‚"); return; }

        try {
            // === æ ¸å¿ƒè§£æé€»è¾‘ï¼šå­—ç¬¦ä¸²æš´åŠ›åˆ‡å‰² (100% å…¼å®¹ä½ çš„æ ¼å¼) ===
            
            // 1. å»æ‰ vless://
            let raw = input.substring(8); 

            // 2. æå– åå­— (Hash) -> #èŠéº»-Reality
            let name = "èŠéº»-Reality"; // é»˜è®¤å€¼
            if (raw.includes('#')) {
                const parts = raw.split('#');
                raw = parts[0]; // å‰©ä¸‹çš„éƒ¨åˆ†
                // decodeURIComponent è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
                name = decodeURIComponent(parts[1]).trim();
            }

            // 3. æå– å‚æ•° (Query) -> ?encryption=none&...
            let params = {};
            if (raw.includes('?')) {
                const parts = raw.split('?');
                raw = parts[0]; // å‰©ä¸‹ uuid@ip:port
                const queryStr = parts[1];
                
                // æ‹†è§£ a=1&b=2
                queryStr.split('&').forEach(pair => {
                    const [key, val] = pair.split('=');
                    if (key) params[key] = val || "";
                });
            }

            // 4. æå– UUID, IP, Port -> uuid@ip:port
            let uuid = "", server = "", port = "";
            if (raw.includes('@')) {
                const parts = raw.split('@');
                uuid = parts[0];
                const address = parts[1]; // ip:port
                
                // å¤„ç† ipv6 æˆ– ipv4
                if (address.includes(']:')) { 
                    // IPv6 æš‚ä¸å¤„ç†å¤æ‚æƒ…å†µï¼ŒæŒ‰ IPv4 é€»è¾‘å…¼å®¹
                    const addrParts = address.split(']:');
                    server = addrParts[0] + ']';
                    port = addrParts[1];
                } else if (address.includes(':')) {
                    const addrParts = address.split(':');
                    server = addrParts[0];
                    port = addrParts[1];
                }
            }

            // 5. ç»„è£…å‚æ•° (ä½ çš„é“¾æ¥é‡Œæœ‰çš„)
            const pbk = params['pbk'] || "";
            const sid = params['sid'] || "";
            const flow = params['flow'] || ""; // å¦‚æœä½ æƒ³å…³æ‰æµæ§ï¼Œæ‰‹åŠ¨æ”¹è¿™é‡Œä¸º ""
            const sni = params['sni'] || "www.microsoft.com";
            const fp  = params['fp'] || "chrome";
            const type = params['type'] || "tcp";

            // æ ¡éªŒ
            if (!uuid || !server || !port || !pbk) {
                alert("âŒ è§£æå¤±è´¥ï¼šç¼ºå°‘å…³é”®ä¿¡æ¯ (UUID/IP/Port/Public Key)\nè¯·ç¡®è®¤é“¾æ¥æ ¼å¼æ­£ç¡®ï¼");
                return;
            }

            // === ç”Ÿæˆ YAML æ¨¡æ¿ (å®Œå…¨æŒ‰ç…§ä½ çš„è¦æ±‚) ===
            const yaml = `# clash-config.yaml
# ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}
port: 7890
socks-port: 7891
mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
external-controller: '127.0.0.1:9090'
ipv6: false

# DNS è®¾ç½® (é˜²æ³„æ¼ä¼˜åŒ–)
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.localhost"
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - 'https://doh.pub/dns-query'
    - 'https://dns.alidns.com/dns-query'
  fallback:
    - 'https://1.1.1.1/dns-query'
    - 'https://dns.google/dns-query'
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4

# ä»£ç†èŠ‚ç‚¹
proxies:
  - name: "${name}"
    type: vless
    server: ${server}
    port: ${port}
    uuid: ${uuid}
    network: ${type}
    tls: true
    udp: true
    flow: ${flow}
    servername: ${sni}
    client-fingerprint: ${fp}
    icon: "${ICON_URL}"
    reality-opts:
      public-key: ${pbk}
      short-id: ${sid}

# ä»£ç†ç»„
proxy-groups:
  - name: ğŸ± çŒ«çŒ«åŸºåœ°
    type: select
    icon: "${ICON_URL}"
    proxies:
      - "${name}"
      - DIRECT

# è§„åˆ™
rules:
  # === å¹¿å‘Šæ‹¦æˆª ===
  - DOMAIN-KEYWORD,adservice,REJECT
  - DOMAIN-SUFFIX,googleadservices.com,REJECT

  # === å±€åŸŸç½‘ ===
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT

  # === å›½å†…ç›´è¿ ===
  - DOMAIN-SUFFIX,cn,DIRECT
  - DOMAIN-KEYWORD,-cn,DIRECT
  - DOMAIN-SUFFIX,126.net,DIRECT
  - DOMAIN-SUFFIX,163.com,DIRECT
  - DOMAIN-SUFFIX,qq.com,DIRECT
  - DOMAIN-SUFFIX,baidu.com,DIRECT
  - DOMAIN-SUFFIX,taobao.com,DIRECT
  - DOMAIN-SUFFIX,alipay.com,DIRECT
  - DOMAIN-SUFFIX,bilibili.com,DIRECT
  - DOMAIN-SUFFIX,jd.com,DIRECT
  - DOMAIN-SUFFIX,zhihu.com,DIRECT
  - DOMAIN-SUFFIX,weibo.com,DIRECT
  
  # === å¼ºåˆ¶ä»£ç† ===
  - DOMAIN-SUFFIX,google.com,ğŸ± çŒ«çŒ«åŸºåœ°
  - DOMAIN-SUFFIX,youtube.com,ğŸ± çŒ«çŒ«åŸºåœ°
  - DOMAIN-SUFFIX,github.com,ğŸ± çŒ«çŒ«åŸºåœ°
  - DOMAIN-SUFFIX,telegram.org,ğŸ± çŒ«çŒ«åŸºåœ°
  - DOMAIN-SUFFIX,twitter.com,ğŸ± çŒ«çŒ«åŸºåœ°
  - DOMAIN-SUFFIX,openai.com,ğŸ± çŒ«çŒ«åŸºåœ°

  # === æœ€ç»ˆè§„åˆ™ ===
  - GEOIP,CN,DIRECT
  - MATCH,ğŸ± çŒ«çŒ«åŸºåœ°
`;
            
            // è¾“å‡ºç»“æœ
            document.getElementById('output').value = yaml;

        } catch (e) {
            console.error(e);
            alert("âŒ ç¨‹åºå‡ºé”™ï¼š" + e.message);
        }
    }

    function copyResult() {
        const text = document.getElementById('output');
        if(!text.value) { alert("è¯·å…ˆç”Ÿæˆå†…å®¹ï¼"); return; }
        text.select();
        navigator.clipboard.writeText(text.value).then(() => {
            alert("âœ… å¤åˆ¶æˆåŠŸï¼è¯·è¦†ç›– config.yaml æ–‡ä»¶ã€‚");
        });
    }
</script>

</body>
</html>
